<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Web Bluetooth configuration interface for Tide Light">
  <meta name="theme-color" content="#1e3a8a">
  <title>Tide Light Config</title>
  <link rel="stylesheet" href="/src/css/main.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <h1 class="title">üåä Tide Light Config</h1>
      <div class="header-controls">
        <div class="demo-mode-toggle">
          <label class="toggle-label">
            <input type="checkbox" id="demo-mode-checkbox">
            <span class="toggle-text">Demo Mode</span>
          </label>
        </div>
        <div id="connection-status" class="connection-status">
          <span class="status-dot" id="status-dot"></span>
          <span class="status-text" id="status-text">Not Connected</span>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Demo Mode Banner -->
      <div id="demo-mode-banner" class="demo-mode-banner" style="display: none;">
        üé≠ Demo Mode Active - Using simulated device
      </div>

      <!-- Browser Support Warning -->
      <div id="browser-warning" class="warning-banner" style="display: none;">
        ‚ö†Ô∏è Web Bluetooth is not supported in this browser. Please use Chrome or Edge on Android/Desktop.
      </div>

      <!-- Connection Section -->
      <section class="section" id="connection-section">
        <button id="connect-btn" class="btn btn-primary btn-large">
          Connect to Device
        </button>
        <p class="hint">Click to scan for Tide Light devices via Bluetooth</p>
      </section>

      <!-- Map Section -->
      <section class="section" id="map-section" style="display: none;">
        <h2 class="section-title">üìç Location</h2>
        <div id="map" class="map-container"></div>
        
        <div class="coordinates-input">
          <div class="input-group">
            <label for="lat-input">Latitude</label>
            <input type="number" id="lat-input" step="0.000001" placeholder="59.908559">
          </div>
          <div class="input-group">
            <label for="lon-input">Longitude</label>
            <input type="number" id="lon-input" step="000001" placeholder="10.73451">
          </div>
        </div>

        <button id="current-location-btn" class="btn btn-secondary">
          üìç Use Current Location
        </button>

        <div id="validation-status" class="validation-status"></div>
      </section>

      <!-- Configuration Section -->
      <section class="section" id="config-section" style="display: none;">
        <h2 class="section-title">üí° LED Settings</h2>
        
        <div class="form-group">
          <label for="brightness-input">
            Brightness
            <span id="brightness-value" class="value-display">50</span>
          </label>
          <input type="range" id="brightness-input" min="0" max="255" value="50" class="slider">
        </div>

        <div class="form-group" id="ldr-group">
          <label class="checkbox-label">
            <input type="checkbox" id="ldr-toggle-input">
            <span>Auto-brightness (LDR) <span class="info-hint" title="Automatically adjust brightness based on ambient light">‚ÑπÔ∏è</span></span>
          </label>
        </div>

        <div class="form-group">
          <label for="pattern-select">Pattern</label>
          <select id="pattern-select" class="select-input">
            <option value="none">None</option>
            <option value="wave">Wave</option>
          </select>
        </div>

        <div class="form-group" id="wave-speed-group">
          <label for="wave-speed-input">Wave Speed (seconds)</label>
          <input type="number" id="wave-speed-input" min="0.1" max="5.0" step="0.1" value="0.5" class="number-input">
        </div>

        <div class="form-group">
          <label for="led-count-input">LED Count</label>
          <input type="number" id="led-count-input" min="3" max="255" value="60" class="number-input">
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="led-invert-input">
            <span>Invert LED Strip</span>
          </label>
        </div>

        <button id="apply-btn" class="btn btn-primary">Apply Changes</button>
      </section>

      <!-- WiFi Configuration Section -->
      <section class="section" id="wifi-section" style="display: none;">
        <h2 class="section-title">üì∂ WiFi Configuration</h2>
        
        <div id="wifi-current-status" class="wifi-current-status">
          <div class="status-label">Status:</div>
          <div id="wifi-status-display" class="status-value">Not connected</div>
        </div>

        <!-- Scan Button -->
        <div id="wifi-scan-view">
          <button id="wifi-scan-btn" class="btn btn-secondary btn-block">Scan for Networks</button>
          <p class="hint">Connect your Tide Light to your WiFi network</p>
        </div>

        <!-- Network List -->
        <div id="wifi-networks-view" style="display: none;">
          <div id="wifi-networks-list" class="wifi-networks-list">
            <div class="loading">Scanning for networks...</div>
          </div>
          <button id="wifi-rescan-btn" class="btn btn-secondary btn-small">Rescan</button>
        </div>

        <!-- Password Input -->
        <div id="wifi-password-view" style="display: none;">
          <div class="wifi-selected-network">
            <span class="wifi-ssid-label">Network:</span>
            <strong id="wifi-selected-ssid"></strong>
          </div>
          <div class="form-group">
            <label for="wifi-password-input">Password</label>
            <input type="password" id="wifi-password-input" class="text-input" placeholder="Enter WiFi password">
            <label class="checkbox-label">
              <input type="checkbox" id="wifi-show-password">
              <span>Show password</span>
            </label>
          </div>
          <div class="button-group">
            <button id="wifi-connect-btn" class="btn btn-primary">Connect</button>
            <button id="wifi-cancel-btn" class="btn btn-secondary">Cancel</button>
          </div>
        </div>

        <!-- Connection Status -->
        <div id="wifi-connection-status" class="wifi-connection-status" style="display: none;">
          <div class="status-message" id="wifi-status-message"></div>
          <button id="wifi-done-btn" class="btn btn-primary">Done</button>
        </div>
      </section>

      <!-- System Settings Section -->
      <section class="section" id="system-section" style="display: none;">
        <h2 class="section-title">‚öôÔ∏è System Settings</h2>
        
        <div id="rtc-group">
          <h3 class="subsection-title">üïê Device Time</h3>
          <div class="info-card">
            <div class="form-group">
              <label>Current Device Time:</label>
              <div id="device-time-display" class="value-display">--:--:--</div>
            </div>
            <div class="form-group">
              <label>Browser Time:</label>
              <div id="browser-time-display" class="value-display">--:--:--</div>
            </div>
            <button id="sync-time-btn" class="btn btn-primary">Sync Device to Browser Time</button>
            <p class="hint">Synchronize device time with your browser's current time. Important for accurate tide calculations when offline.</p>
          </div>
        </div>

        <div id="reset-group">
          <h3 class="subsection-title">üîÑ Factory Reset</h3>
          <div class="info-card">
            <p class="warning-text">‚ö†Ô∏è This will restore all settings to factory defaults. This action cannot be undone!</p>
            <button id="factory-reset-btn" class="btn btn-danger">Reset to Factory Defaults</button>
            <p class="hint">Use this to restore the device to its original configuration. All custom settings will be lost.</p>
          </div>
        </div>
      </section>

      <!-- Status Section -->
      <section class="section" id="status-section" style="display: none;">
        <h2 class="section-title">üåä Current Tide State</h2>
        
        <div id="tide-status" class="status-card">
          <div class="loading">Loading tide data...</div>
        </div>

        <h3 class="subsection-title">‚úì Data Validation</h3>
        <div id="tide-validation" class="validation-card">
          <div class="validation-pending">Validation not yet performed</div>
        </div>

        <h3 class="subsection-title">üì¶ Cache Info</h3>
        <div id="cache-info" class="info-card"></div>

        <h3 class="subsection-title">‚öôÔ∏è System Info</h3>
        <div id="system-info" class="info-card"></div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Tide Light v3 ¬∑ Web Bluetooth Configuration</p>
    </footer>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel" style="display: none;">
      <div class="debug-header" id="debug-header">
        <span class="debug-title">‚ö†Ô∏è Error Details</span>
        <button class="debug-toggle" id="debug-toggle">‚ñº</button>
      </div>
      <div class="debug-content" id="debug-content">
        <div class="debug-message" id="debug-message"></div>
        <div class="debug-actions">
          <button class="btn btn-small" id="debug-show-logs">Show All Logs</button>
          <button class="btn btn-small" id="debug-clear">Clear</button>
        </div>
      </div>
    </div>

    <!-- Floating Debug Button (for mobile) -->
    <button id="floating-debug-btn" class="floating-debug-btn" title="Show console logs">
      üêõ
    </button>
  </div>

  <!-- Notifications Container -->
  <div id="notifications" class="notifications-container"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <p id="loading-message">Loading...</p>
  </div>

  <script type="module" src="/src/js/main.js"></script>
</body>
</html>
